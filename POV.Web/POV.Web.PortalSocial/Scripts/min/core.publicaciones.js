function initPage(){$("#dialog-people-likes").dialog("close");if(place==MURO){$.get("../Scripts/tmpl/pubs.tmpl.htm",function(a){$("body").append(a);$("#postit").css("display","none");$("#txtPublicacion").autoResize({onResize:function(){$(this).css({opacity:.9})},animateCallback:function(){$(this).css({opacity:1})},animateDuration:200,extraSpace:5});pubs_current=1;$("#txtPublicacion").focus(function(){$("#postit").css("display","block")});$("#txtPublicacion").blur(function(){var a=$("#txtPublicacion").val().trim();if(a=="")$("#postit").css("display","none")});$("#btnShare").bind("click",compartir);$("#dialogpub").dialog({autoOpen:"false"});$("#dialogpub").dialog("close");$("#dialogcom").dialog({autoOpen:"false"});$("#dialogcom").dialog("close");LoadPubs()});setInterval("ReloadPubs()",7e4)}else if(place==INICIO){$.get("../Scripts/tmpl/pubs.tmpl.htm",function(a){$("body").append(a);pubs_current=1;LoadPubsSocial();setInterval("ReloadPubs()",7e4)})}else if(place==VIEW_PUB){$.get("../Scripts/tmpl/pubs.tmpl.htm",function(a){$("body").append(a);$("#dialogpub").dialog({autoOpen:"false"});$("#dialogpub").dialog("close");$("#dialogcom").dialog({autoOpen:"false"});$("#dialogcom").dialog("close");loadPublicacionComplete()})}}function compartir(){var a=$("#txtPublicacion").val();a=$.trim(a);if(a!=""){var b={publicaciondto:{contenido:a,usuariosocialid:usrse.val(),socialhubid:hub.val(),tipo:1}};var c=$.toJSON(b);api.Share({success:function(a){$("#txtPublicacion").css("height","54px");showPublicacion(a.d)}},c)}}function getOption(a,b){if(b=="delcom"){return'<input type="button" id="btnDelete" title="Eliminar Comentario" onclick="javascript:removeComentario(\''+a+'\');" class="operDel icon icon_cross floatRight"/>'}else if(b=="delpub"){return'<input type="button" id="btnDelete" title="Eliminar Publicación" onclick="javascript:removePublicacion(\''+a+'\');" class="operDel icon icon_cross floatRight"/>'}else{return""}}function LoadPubs(){var a={dto:{pagesize:10,currentpage:pubs_current,socialhubid:hub.val(),usuariosocialid:usr.val(),estatus:1}};var b=$.toJSON(a);api.LoadPubs({success:function(a){printPublicaciones(a)}},b)}function LoadPubsSocial(){var a={dto:{pagesize:10,currentpage:pubs_current,socialhubid:hub.val(),usuariosocialid:usr.val(),estatus:1}};var b=$.toJSON(a);api.LoadPubsSocial({success:function(a){printPublicaciones(a)}},b)}function printPublicaciones(a){var b=$.toJSON(a);if(a.d.length<=0){if(pubs_current==1){var c="<span>No se ha compartido ninguna publicación</span>";$("#more").empty();$("#more").html(c)}else{var c="<span>No existen más publicaciones</span>";$("#more").empty();$("#more").html(c)}}else{for(var d=0;d<a.d.length;d++){var e=document.getElementById(a.d[d].publicacionid);if(!e){$("#pubTmpl").tmpl(a.d[d],{getOption:getOption,getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).appendTo("#PublicacionStream")}else{var f=$("#pubTmpl").tmpl(a.d[d],{getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).html();$("#"+a.d[d].publicacionid).html(f)}}$("ul#PublicacionStream li").each(function(){$(this).fadeIn(1e3)});$('button[id|="btn-del"]').each(function(a){$(this).button({icons:{primary:"ui-icon-close"},text:false})});$('button[id|="btn-reportar"]').each(function(a){$(this).button({icons:{primary:"ui-icon-flag"},text:false})});if(a.d.length<10){var c="<span>No existen más publicaciones</span>";$("#more").empty();$("#more").html(c)}else{if(place==MURO)$("#more").html('<a class="link_blue" onclick="javascript:LoadPubs();" >Mostrar más publicaciones</a>');else $("#more").html('<a class="link_blue" onclick="javascript:LoadPubsSocial();" >Mostrar más publicaciones</a>')}}pubs_current++}function showPublicacion(a){$("#pubTmpl").tmpl(a,{getOption:getOption,getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).prependTo("#PublicacionStream");$("#txtPublicacion").val("");$("ul#PublicacionStream li:first").fadeIn(100);$("#more").html('<a class="link_blue" onclick="javascript:LoadPubs();" >Mostrar más publicaciones</a>');ChangeBtnDelete();ChangeBtnAbuso()}function removePublicacion(a){var b=new MessageApi;var c="Se eliminará la publicación y sus comentarios <br />¿Desea Continuar?";b.CreateQuestionMessage(c,function(){$("#dialog-question").dialog("close");removePublicacionFromServer(a)});b.ShowQuestion()}function removePublicacionFromServer(a){var b={dto:{publicacionid:a}};var c=$.toJSON(b);api.RemovePub({success:function(a){removePublicacionFromUI(a)}},c)}function removePublicacionFromUI(a){var b=$.toJSON(a);if(a.d.success!=null&&a.d.success==true){var c=document.getElementById(a.d.publicacionid);$(c).remove();if(place==VIEW_PUB){window.location=defaulturl.val()}}else{$(hdnmessageinputid).val(a.d.error);$(hdnmessagetypeinputid).val("1");mostrarError()}}function removeComentario(a){var b=new MessageApi;var c="Se eliminará el comentario<br />¿Desea Continuar?";b.CreateQuestionMessage(c,function(){$("#dialog-question").dialog("close");removeComentarioFromServer(a)});b.ShowQuestion()}function removeComentarioFromServer(a){var b={dto:{comentarioid:a}};var c=$.toJSON(b);api.RemoveComment({success:function(a){removeComentarioFromUI(a)}},c)}function removeComentarioFromUI(a){if(a.d.success!=null&&a.d.success==true){var b=document.getElementById(a.d.comentarioid);$(b).remove()}else{$(hdnmessageinputid).val(a.d.error);$(hdnmessagetypeinputid).val("1");mostrarError()}}function commentenable(a){var b=document.getElementById(a);var c={publicacionid:a};var d=$.toJSON(c);$("#panelcomment").remove().fadeIn("slow");$("#areacomTmpl").tmpl(c,{urlFiles:getFilesUrl}).appendTo(b).fadeIn(1e3);var e=$(b).find("#panelcomment").find("textarea");$(e).autoResize({onResize:function(){$(this).css({opacity:.9})},animateCallback:function(){$(this).css({opacity:1})},animateDuration:200,extraSpace:1});var f={maxCharacterSize:200,originalStyle:"display_info_textarea",warningStyle:"display_warning_textarea",warningNumber:200,displayFormat:"#left caracteres restantes de #max max."};$(e).textareaCount(f);e.focus()}function cancelComment(){$("#panelcomment").remove().fadeIn("slow")}function sendcomment(a,b){var c=$("#txtComment").val();c=$.trim(c);if(c!=""&&a!=""){var d={dto:{publicacionid:a,usuariosocialidcom:usrse.val(),contenidocom:c}};var e=$.toJSON(d);api.Comment({success:function(a){showComment(a)}},e)}}function showComment(a){var b=document.getElementById(a.d.publicacionid);$(b).find("#panelcomment").remove();$(b).find(".opcomentar").remove();var c=$.toJSON(a);var d=document.getElementById(a.d.publicacionid+"_comments");$("#comTmpl").tmpl(a.d,{getOption:getOption,getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).appendTo(d).fadeIn(100);ChangeBtnDelete();ChangeBtnAbuso()}function ReloadPubs(){index_li=1;size_li=$("#PublicacionStream > li").size();ToReloadPubs(1)}function ToReloadPubs(a){var b={dto:{pagesize:10,currentpage:a,socialhubid:hub.val(),usuariosocialid:usr.val(),estatus:1}};var c=$.toJSON(b);if(place==MURO){api.LoadPubs({success:function(b){for(var c=0;c<b.d.length;c++){RefreshPublication(b.d[c],index_li);index_li++}if(a<pubs_current-1){a++;ToReloadPubs(a)}else{if(index_li<=$("#PublicacionStream > li").size()){var d=$("#PublicacionStream > li").size();for(var e=index_li;e<=d;e++){$("#PublicacionStream > li:nth-child("+e+")").remove()}$("#more").html('<a class="link_blue" onclick="javascript:LoadPubs();" >Mostrar más publicaciones</a>')}}}},c)}else if(place==INICIO){api.LoadPubsSocial({success:function(b){for(var c=0;c<b.d.length;c++){RefreshPublication(b.d[c],index_li);index_li++}if(a<pubs_current-1){a++;ToReloadPubs(a)}else{if(index_li<=$("#PublicacionStream > li").size()){var d=$("#PublicacionStream > li").size();for(var e=index_li;e<=d;e++){$("#PublicacionStream > li:nth-child("+e+")").remove()}$("#more").html('<a class="link_blue" onclick="javascript:LoadPubsSocial();" >Mostrar más publicaciones</a>')}}}},c)}}function RefreshPublication(a,b){if(b>size_li){$("#pubTmpl").tmpl(a,{getOption:getOption,getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).appendTo("#PublicacionStream").fadeIn(100);ChangeBtnDelete();ChangeBtnAbuso()}else{var c=$("#PublicacionStream > li:nth-child("+b+")");c.attr("id",a.publicacionid);var d=document.getElementById(a.publicacionid);if(!c){var e=$("#pubTmpl").tmpl(a,{getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).html();c.html(e)}else{var f=$(c).find("#panelcomment");if(!f.html()){var g=document.getElementById("request_complete_"+a.publicacionid);if(g!=null){LoadPubComplete(a.publicacionid)}else{var e=$("#pubTmpl").tmpl(a,{getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).html();c.html(e);ChangeBtnDelete();ChangeBtnAbuso()}}}}}function LoadPubComplete(a){if(a!=null&&a!=""){var b={dto:{publicacionid:a,complete:true}};var c=$.toJSON(b);api.GetPub({success:function(b){var c=document.getElementById(b.d.publicacionid);$("#"+a).html("");var d=$("#pubTmpl").tmpl(b.d,{getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).html();$("#"+a).html(d);ChangeBtnDelete();ChangeBtnAbuso()}},c)}}function showoption(a,b){$(a).append(b)}function LikePub(a,b){if(a!=null&&a!=""){var c={dto:{publicacionid:a,usuarioid:usrse.val(),vote:b}};var d=$.toJSON(c);api.LikePub({success:function(a){updateVotesPublicacion(a)}},d)}}function updateVotesPublicacion(a){if(a.d!=null){$("#votes0_"+a.d.publicacionid).attr("title",a.d.numvotes1+" excelente");$("#votes1_"+a.d.publicacionid).attr("title",a.d.numvotes2+" bien");$("#votes2_"+a.d.publicacionid).attr("title",a.d.numvotes3+" regular");$("#votes0_"+a.d.publicacionid).attr("value","("+a.d.numvotes1+")");$("#votes1_"+a.d.publicacionid).attr("value","("+a.d.numvotes2+")");$("#votes2_"+a.d.publicacionid).attr("value","("+a.d.numvotes3+")")}}function LikeComment(a,b){if(a!=null&&a!=""){var c={dto:{comentarioid:a,usuariosocialidcom:usrse.val(),vote:b}};var d=$.toJSON(c);api.LikeComment({success:function(a){updateVotesComentario(a)}},d)}}function updateVotesComentario(a){if(a.d!=null){$("#votes0_"+a.d.comentarioid).attr("title",a.d.numvotes1+" excelente");$("#votes1_"+a.d.comentarioid).attr("title",a.d.numvotes2+" bien");$("#votes2_"+a.d.comentarioid).attr("title",a.d.numvotes3+" regular");$("#votes0_"+a.d.comentarioid).attr("value","("+a.d.numvotes1+")");$("#votes1_"+a.d.comentarioid).attr("value","("+a.d.numvotes2+")");$("#votes2_"+a.d.comentarioid).attr("value","("+a.d.numvotes3+")")}}function showPeople(a,b){if(a!=""){var c={dto:{rankingid:a,vote:b}};var d=$.toJSON(c);api.GetPeople({success:function(a){$("#people-stream").empty();if(a.d.peoples.length>0){$("#peopleTmpl").tmpl(a.d,{urlFiles:getFilesUrl}).appendTo("#people-stream");var b=a.d.vote=="0"?"Excelente":a.d.vote=="1"?"Bien":"Regular";$("#dialog-people-likes").dialog({autoOpen:false,minHeight:200,maxHeight:500,width:400,resizable:false,modal:true,title:b});$(".ui-widget-overlay").live("click",function(){$("#dialog-people-likes").dialog("close")});$("#dialog-people-likes").dialog("open")}}},d)}}function ChangeBtnDelete(){$('button[id|="btn-del"]').each(function(a){$(this).button({icons:{primary:"ui-icon-close"},text:false})});$("button[id|=btn-reportar]").each(function(a){$(this).button({icons:{primary:"ui-icon-flag"},text:false})})}function ChangeBtnAbuso(){$('button[id|="btn-reportar"]').each(function(a){$(this).button({icons:{primary:"ui-icon-flag"},text:false})})}function getTipoTexto(){return TIPO_PUBLICACION_TEXTO.val()}function loadPublicacionComplete(){if(publicacionID.val()!=null&&publicacionID.val()!=""){var a={dto:{publicacionid:publicacionID.val(),complete:true}};var b=$.toJSON(a);api.GetPub({success:function(a){$("#pubTmpl").tmpl(a.d,{getOption:getOption,getTipoTexto:getTipoTexto,urlFiles:getFilesUrl}).appendTo("#PublicacionStream");$("ul#PublicacionStream li").each(function(){$(this).fadeIn(1e3)});ChangeBtnDelete();ChangeBtnAbuso()}},b)}else{if(place==VIEW_PUB){var c='<p style="text-align:center">No se encontro la publicacion seleccionada</p>';$("#PublicacionStream").empty();$("#PublicacionStream").html(c)}}}function getFilesUrl(){var a=2;return"../Files/ImagenUsuario/ImagenPerfil.aspx?r="+a}function reportarAbusoPublicacionFromServer(a){var b=new ReporteAbusoApi;var c={dto:{reportableid:a,tiporeporte:1}};var d=$.toJSON(c);b.AddReporteAbuso({success:function(b){removeElementoReportadaFromUI(a)},error:function(a){$(hdnmessageinputid).val(c.d.error);$(hdnmessagetypeinputid).val("1");mostrarError();return}},d)}function reportarAbusoComentarioFromServer(a){var b=new ReporteAbusoApi;var c={dto:{reportableid:a,tiporeporte:2}};var d=$.toJSON(c);b.AddReporteAbuso({success:function(b){removeElementoReportadaFromUI(a)},error:function(a){$(hdnmessageinputid).val(c.d.error);$(hdnmessagetypeinputid).val("1");mostrarError();return}},d)}function reportarAbusoComentario(a){var b=new ReporteAbusoApi;b.validateReportarAbuso({success:function(b){if(b!=null&&b.d){if(!b.d.success){var c=new MessageApi;var d=b.d.error;c.CreateMessage(d,"ERROR");c.Show()}else{var c=new MessageApi;var d="Se reportará como abuso el elemento seleccionado <br />¿Desea Continuar?";c.CreateQuestionMessage(d,function(){$("#dialog-question").dialog("close");reportarAbusoComentarioFromServer(a)});c.ShowQuestion()}}},error:function(a){if(a.d&&a.d.length>0&&a.d.error.length>0){$(hdnmessageinputid).val(a.d.error);$(hdnmessagetypeinputid).val("1");mostrarError();return}}})}function reportarAbusoPublicacion(a){var b=new ReporteAbusoApi;b.validateReportarAbuso({success:function(b){if(b!=null&&b.d){if(!b.d.success){var c=new MessageApi;var d=b.d.error;c.CreateMessage(d,"ERROR");c.Show()}else{var c=new MessageApi;var d="Se reportará como abuso el elemento seleccionado <br />¿Desea Continuar?";c.CreateQuestionMessage(d,function(){$("#dialog-question").dialog("close");reportarAbusoPublicacionFromServer(a)});c.ShowQuestion()}}},error:function(a){if(a.d&&a.d.length>0&&a.d.error.length>0){$(hdnmessageinputid).val(a.d.error);$(hdnmessagetypeinputid).val("1");mostrarError();return}}})}function removeElementoReportadaFromUI(a){if(a){var b=document.getElementById(a);$(b).remove();if(place==VIEW_PUB){window.location=defaulturl.val()}}}$(document).ready(initPage);var api=new PublicacionApi;var index_li=0;var size_li=0