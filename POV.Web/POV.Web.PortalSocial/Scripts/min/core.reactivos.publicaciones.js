function CargaPublicaciones(){$("#content").block({message:'<h1 style="font-size:20px;"><img src="../images/ajax-loader.gif" /> Cargando...</h1>'});var a={dto:{pagesize:30,currentpage:curpage,socialhubid:hub.val(),estatus:1}};var b=$.toJSON(a);apiPub.LoadSugerencias({success:function(a){printPublicaciones(a);$("#content").unblock()}},b)}function printPublicaciones(a){var b=$.toJSON(a);if(a.d==null||a.d.length<=0){if(curpage==1){var c="<span>No se ha compartido ninguna sugerencia</span>";$("#more").empty();$("#more").html(c)}else{var c="<span>No existen más sugerencias</span>";$("#more").empty();$("#more").html(c)}}else{for(var d=0;d<a.d.length;d++){var e=document.getElementById(a.d[d].publicacionid);if(!e){$("#pubTmpl").tmpl(a.d[d],{urlFiles:getFilesUrl}).appendTo("#PublicacionStream")}else{var f=$("#pubTmpl").tmpl(a.d[d],{urlFiles:getFilesUrl}).html();$("#"+a.d[d].publicacionid).html(f)}}ChangeBtnDelete();if(a.d.length>=30)$("#more").html('<a class="link_blue" onclick="javascript:CargaPublicaciones();" >Mostrar más publicaciones</a>');else{var c="<span>No existen más sugerencias</span>";$("#more").empty();$("#more").html(c)}}curpage++}function LikePub(a,b){if(a!=null&&a!=""){var c={dto:{publicacionid:a,usuarioid:usrse.val(),vote:b}};var d=$.toJSON(c);apiPub.LikePub({success:function(a){updateVotesPublicacion(a)}},d)}}function updateVotesPublicacion(a){if(a.d!=null){$("#votes0_"+a.d.publicacionid).attr("title",a.d.numvotes1+" excelente");$("#votes1_"+a.d.publicacionid).attr("title",a.d.numvotes2+" bien");$("#votes2_"+a.d.publicacionid).attr("title",a.d.numvotes3+" regular");$("#votes0_"+a.d.publicacionid).attr("value","("+a.d.numvotes1+")");$("#votes1_"+a.d.publicacionid).attr("value","("+a.d.numvotes2+")");$("#votes2_"+a.d.publicacionid).attr("value","("+a.d.numvotes3+")")}}function showPeople(a,b){if(a!=""){var c={dto:{rankingid:a,vote:b}};var d=$.toJSON(c);apiPub.GetPeople({success:function(a){$("#people-stream").empty();if(a.d.peoples.length>0){$("#peopleTmpl").tmpl(a.d,{urlFiles:getFilesUrl}).appendTo("#people-stream");var b=a.d.vote=="0"?"Excelente":a.d.vote=="1"?"Bien":"Regular";$("#dialog-people-likes").dialog({autoOpen:false,minHeight:200,maxHeight:500,width:400,resizable:false,modal:true,title:b});$(".ui-widget-overlay").live("click",function(){$("#dialog-people-likes").dialog("close")});$("#dialog-people-likes").dialog("open")}}},d)}}function ChangeBtnDelete(){$('button[id|="btn-del"]').each(function(a){$(this).button({icons:{primary:"ui-icon-close"},text:false})})}function removePublicacion(a){var b=new MessageApi;var c="Se eliminarán los datos de la sugerencia <br />¿Desea Continuar?";b.CreateQuestionMessage(c,function(){$("#dialog-question").dialog("close");removePublicacionFromServer(a)});b.ShowQuestion()}function removePublicacionFromServer(a){var b={dto:{publicacionid:a}};var c=$.toJSON(b);apiPub.RemovePub({success:function(a){removePublicacionFromUI(a)}},c)}function removePublicacionFromUI(a){var b=$.toJSON(a);if(a.d.success!=null&&a.d.success==true){var c=document.getElementById(a.d.publicacionid);$(c).remove()}else{$(hdnmessageinputid).val(a.d.error);$(hdnmessagetypeinputid).val("1");mostrarError()}}function getFilesUrl(){var a=Math.floor(Math.random()*1e4);return"../Files/ImagenUsuario/ImagenPerfil.aspx?r="+a}function reportarAbusoPublicacionFromServer(a){var b=new ReporteAbusoApi;var c={dto:{reportableid:a,tiporeporte:1}};var d=$.toJSON(c);b.AddReporteAbuso({success:function(b){removeElementoReportadaFromUI(a)},error:function(b){$(hdnmessageinputid).val(a);$(hdnmessagetypeinputid).val("1");mostrarError();return}},d)}function reportarAbusoComentarioFromServer(a){var b=new ReporteAbusoApi;var c={dto:{reportableid:a,tiporeporte:2}};var d=$.toJSON(c);b.AddReporteAbuso({success:function(b){removeElementoReportadaFromUI(a)},error:function(b){$(hdnmessageinputid).val(a);$(hdnmessagetypeinputid).val("1");mostrarError();return}},d)}function reportarAbusoComentario(a){var b=new ReporteAbusoApi;b.validateReportarAbuso({success:function(b){if(b!=null&&b.d){if(!b.d.success){var c=new MessageApi;var d=b.d.error;c.CreateMessage(d,"ERROR");c.Show()}else{var c=new MessageApi;var d="Se reportará como abuso el elemento seleccionado <br />¿Desea Continuar?";c.CreateQuestionMessage(d,function(){$("#dialog-question").dialog("close");reportarAbusoComentarioFromServer(a)});c.ShowQuestion()}}},error:function(a){if(a.d&&a.d.length>0&&a.d.error.length>0){$(hdnmessageinputid).val(a.d.error);$(hdnmessagetypeinputid).val("1");mostrarError();return}}})}function reportarAbusoPublicacion(a){var b=new ReporteAbusoApi;b.validateReportarAbuso({success:function(b){if(b!=null&&b.d){if(!b.d.success){var c=new MessageApi;var d=b.d.error;c.CreateMessage(d,"ERROR");c.Show()}else{var c=new MessageApi;var d="Se reportará como abuso el elemento seleccionado <br />¿Desea Continuar?";c.CreateQuestionMessage(d,function(){$("#dialog-question").dialog("close");reportarAbusoPublicacionFromServer(a)});c.ShowQuestion()}}},error:function(a){if(a.d&&a.d.length>0&&a.d.error.length>0){$(hdnmessageinputid).val(a.d.error);$(hdnmessagetypeinputid).val("1");mostrarError();return}}})}function removeElementoReportadaFromUI(a){if(a){var b=document.getElementById(a);$(b).remove();if(place==VIEW_PUB){window.location=defaulturl.val()}}}var apiPub=new PublicacionApi;$(function(){CargaPublicaciones()})